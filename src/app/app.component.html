<h4>Unprocessed List</h4>
<p>Highlight any of the list items.</p>
<ng-container
  *ngTemplateOutlet="nodeListRef; context: {$implicit: allNodes}"
></ng-container>

<br>

<h4>Processed List</h4>
<p>List items highlighted.</p>
<ul>
  <li *ngFor="let node of nodesProcessed">
    <ng-container
      *ngTemplateOutlet="nodeInformationRef; context: {$implicit: node}"
    ></ng-container>
  </li>
</ul>

<ng-template #nodeListRef let-nodes>
  <ul>
    <ng-container *ngFor="let node of nodes">
      <ng-template
        [ngTemplateOutlet]="nodeActionsRef"
        [ngTemplateOutletContext]="{ node: node }">
      </ng-template>
    </ng-container>
  </ul>
</ng-template>

<ng-template #nodeActionsRef let-node="node">
  <li (mousedown)="onmousedown($event, node)"
      (mouseover)="onmouseover($event, node)"
      (mouseup)="onmouseup($event, node)">
    <ng-container
      *ngTemplateOutlet="nodeInformationRef; context: {$implicit: node}"
    ></ng-container>
  </li>

  <ng-container *ngIf="node?.children.length">
    <ng-container
      *ngTemplateOutlet="nodeListRef; context: {$implicit: node.children}"
    ></ng-container>
  </ng-container>
</ng-template>

<ng-template #nodeInformationRef let-node>
  {{node.id}} - {{node.description}}
</ng-template>
